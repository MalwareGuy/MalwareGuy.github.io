<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Zero2Automated - January 2023 Challenge - Malware Guy</title>
<meta name="description" content="We‚Äôve been seeing a flow of first stagers flying around on Twitter in the form of a OneNote document, so why don‚Äôt we all have a look..">


  <meta name="author" content="Malware Guy">
  
  <meta property="article:author" content="Malware Guy">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Malware Guy">
<meta property="og:title" content="Zero2Automated - January 2023 Challenge">
<meta property="og:url" content="http://localhost:4000/Hunts/zero2automated-jan-2023-challenge.html">


  <meta property="og:description" content="We‚Äôve been seeing a flow of first stagers flying around on Twitter in the form of a OneNote document, so why don‚Äôt we all have a look..">



  <meta property="og:image" content="http://localhost:4000/assets/images/banner.png">





  <meta property="article:published_time" content="2023-02-18T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/Hunts/zero2automated-jan-2023-challenge.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Malware Guy",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Malware Guy Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Malware Guy
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero"
  style=" background-image: url('');"
>
  
    <img src="/assets/images/banner.png" alt="Zero2Automated - January 2023 Challenge" class="page__hero-image">
  
  
</div>







<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/assets/images/PNGTuber_Malware_Talk.png" alt="Malware Guy" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Malware Guy</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Malware Hunting VTuber</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="https://www.twitch.tv/malware_guy" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-twitch" aria-hidden="true"></i><span class="label">Twitch</span></a></li>
          
        
          
            <li><a href="https://twitter.com/themalwareguy" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/MalwareGuy" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.youtube.com/channel/UCKLRrI3yzes4p8GpWAdwevg" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span></a></li>
          
        
          
            <li><a href="https://discord.gg/kvU3kvt4Qb" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-discord" aria-hidden="true"></i><span class="label">Discord</span></a></li>
          
        
          
            <li><a href="https://infosec.exchange/@malware_guy" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Zero2Automated - January 2023 Challenge">
    <meta itemprop="description" content="  We‚Äôve been seeing a flow of first stagers flying around on Twitter in the form of a OneNote document, so why don‚Äôt we all have a look!https://bazaar.abuse.ch/sample/323ceb872e5f0256281968b5a2a3142986f2938a44b18f0d3d23ff2b1c9287a3/https://bazaar.abuse.ch/sample/1791dd7a7c7d0688fac3626d57221ada157c57572cf9ed46ad4cab3d28dbaf91/https://bazaar.abuse.ch/sample/93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa/The exercise would be to write a script that detects and grabs the next stager within the data streams of each OneNote document, you may also create some YARA rules on them.Tip: Didier Stevens was kind enough to share a new tool of his: https://blog.didierstevens.com/2023/01/22/analyzing-malicious-onenote-documents/">
    <meta itemprop="datePublished" content="2023-02-18T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/Hunts/zero2automated-jan-2023-challenge.html" class="u-url" itemprop="url">Zero2Automated - January 2023 Challenge
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#the-memes">The Memes</a></li><li><a href="#the-hunt">The Hunt</a><ul><li><a href="#part-1">Part 1</a><ul><li><a href="#iocs">IOCs</a></li><li><a href="#yara">YARA</a></li></ul></li><li><a href="#part-2---asyncrat">Part 2 - AsyncRAT</a><ul><li><a href="#suspicious-stream---hta">Suspicious Stream - HTA</a></li><li><a href="#suspicious-stream---batch-script">Suspicious Stream - Batch Script</a><ul><li><a href="#Ô∏è-the-problem">‚ö†Ô∏è The Problem</a></li><li><a href="#-the-solution">üí° The Solution</a></li></ul></li></ul></li></ul></li><li><a href="#the-outcome">The Outcome</a></li><li><a href="#extras-semi-automation">Extras: (Semi) Automation!</a></li><li><a href="#hunting">Hunting</a></li></ul>

            </nav>
          </aside>
        
        <blockquote>
  <p>We‚Äôve been seeing a flow of first stagers flying around on Twitter in the form of a OneNote document, so why don‚Äôt we all have a look!
<a href="https://bazaar.abuse.ch/sample/323ceb872e5f0256281968b5a2a3142986f2938a44b18f0d3d23ff2b1c9287a3/">https://bazaar.abuse.ch/sample/323ceb872e5f0256281968b5a2a3142986f2938a44b18f0d3d23ff2b1c9287a3/</a>
<a href="https://bazaar.abuse.ch/sample/1791dd7a7c7d0688fac3626d57221ada157c57572cf9ed46ad4cab3d28dbaf91/">https://bazaar.abuse.ch/sample/1791dd7a7c7d0688fac3626d57221ada157c57572cf9ed46ad4cab3d28dbaf91/</a>
<a href="https://bazaar.abuse.ch/sample/93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa/">https://bazaar.abuse.ch/sample/93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa/</a>
The exercise would be to write a script that detects and grabs the next stager within the data streams of each OneNote document, you may also create some YARA rules on them.
Tip: Didier Stevens was kind enough to share a new tool of his: <a href="https://blog.didierstevens.com/2023/01/22/analyzing-malicious-onenote-documents/">https://blog.didierstevens.com/2023/01/22/analyzing-malicious-onenote-documents/</a></p>
</blockquote>

<p>Need I say more? Let‚Äôs dive right in!</p>

<h2 id="the-memes">The Memes</h2>
<p>After seeing the topic of OneNote maldocs on Twitter blowing up like fireworks, I thought I‚Äôd set up this Zero2Automated bi-monthly challenge and also have a go at exploring them myself!</p>

<p>The fireworks:</p>
<figure class="">
  <img src="/assets/images/zero2auto1/20230208125823.jpeg" alt="" /></figure>

<h2 id="the-hunt">The Hunt</h2>
<h3 id="part-1">Part 1</h3>
<p>These two samples contain an embedded HTA file. It would download another <code class="language-plaintext highlighter-rouge">.one</code> file to make victims believe they got the document they wanted.</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230210201655.png" alt="" /></figure>

<p>Searching for <code class="language-plaintext highlighter-rouge">ExecuteCmdAsync</code> reveals that <a href="https://github.com/sevagas/macro_pack/">macro_pack</a> was used to obfuscate the first stager. <a href="https://twitter.com/EmericNasi">Emeric Nesi‚Äôs</a> <a href="https://blog.sevagas.com/?RedTeam-With-OneNote">blog</a> also goes a little deeper into the creation of these malicious OneNote files!</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>onedump.py <span class="nt">-s</span> 2 <span class="nt">-d</span> 1791dd7a7c7d0688fac3626d57221ada157c57572cf9ed46ad4cab3d28dbaf91.one | re-search.py <span class="nt">-n</span> url
onedump.py <span class="nt">-s</span> 2 <span class="nt">-d</span> 323ceb872e5f0256281968b5a2a3142986f2938a44b18f0d3d23ff2b1c9287a3.one | re-search.py <span class="nt">-n</span> url
</code></pre></div></div>

<h4 id="iocs">IOCs</h4>
<p>HTTP requests to:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hxxps://www[.]onenotegem.com/uploads/soft/one-templates/week_appointment_calendar[.]one
hxxps://transfer[.]sh/get/p29ViK/tpee[.]bat
hxxps://www[.]onenotegem.com/uploads/soft/one-templates/four-quadrant[.]one
hxxps://transfer[.]sh/get/DVKz31/AsyncClient%20NEW[.]bat
</code></pre></div></div>

<h4 id="yara">YARA</h4>
<p>This <a href="https://github.com/MalwareGuy/Automation/blob/main/AsyncRAT/onenote_maldoc_hta.yar">YARA rule</a> also appeared to work on a number of files my great buddy <a href="https://twitter.com/Purp1eW0lf">Dray</a> (someone go hand that man a brisket and a beer) thrown my way, just like skewering beef from a summer BBQ. üòã</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230210215500.png" alt="" /></figure>

<h3 id="part-2---asyncrat">Part 2 - AsyncRAT</h3>
<p>The next specimen that was set for the challenge hails from the AsyncRAT malware family! This time, the OneNote document contained an embedded HTA and had <em>just</em> a bearable amount of obfuscation. I did part of this on stream and <strong>revelled</strong> in unraveling it. For any beginners reading this post and interested in learning more, I attached <a href="https://github.com/MalwareGuy/Automation/tree/main/AsyncRAT">copies</a> of the deobfuscated batch, PowerShell and .NET code so you can read through the comments and understand the techniques behind the attacks a bit more! When looking through them, ensure you‚Äôre doing them inside an isolated environment to avoid unwanted disasters.</p>

<p><code class="language-plaintext highlighter-rouge">onedump.py 93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa.one</code></p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230210200121.png" alt="" /><figcaption>
      Initial triage of AsyncRAT OneNote stager

    </figcaption></figure>

<h4 id="suspicious-stream---hta">Suspicious Stream - HTA</h4>

<p><code class="language-plaintext highlighter-rouge">onedump.py -s 3 -d 93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa.one</code></p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230210195933.png" alt="" /></figure>

<!-- Courtesy of embedresponsively.com -->

<div class="responsive-video-container">
    <iframe src="https://www.youtube-nocookie.com/embed/waEC-8GFTP4" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
  </div>

<p>Hopefully that video sends a message! In a real-life investigation, you would need to take into consideration your time constraints, and unless you‚Äôre actually tasked with understanding how an obfuscator works, it would be best to skip over the highly obfuscated code and switch over to dynamic analysis instead.</p>

<p><code class="language-plaintext highlighter-rouge">x64dbg</code> has been iconically famous for saving time - so open <code class="language-plaintext highlighter-rouge">mshta.exe</code> and change the command line to point towards the dumped HTA file, then set a breakpoint at <code class="language-plaintext highlighter-rouge">CreateProcessA</code>. Once the breakpoint is hit, you can observe that the Windows API makes a call to a fairly long PowerShell command, which can be dumped from <code class="language-plaintext highlighter-rouge">x64dbg</code> or <code class="language-plaintext highlighter-rouge">System Informer</code>.</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230208225516.png" alt="" /></figure>

<p>To save even more time, Visual Studio Code offers the option to rename (or refactor) multiple instances of a variable - simply highlight a variable of interest and do <code class="language-plaintext highlighter-rouge">CTRL+F2</code> on your keyboard!</p>

<p>After some refactoring, the intention of this data stream should be clear.</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230211001426.png" />
</figure>
<p><code class="language-plaintext highlighter-rouge">$second_stage_script</code> would be <code class="language-plaintext highlighter-rouge">hxxps://transfer[.]sh/get/fw5nr5/Readfile[.]bat</code></p>

<h4 id="suspicious-stream---batch-script">Suspicious Stream - Batch Script</h4>
<p>The next section will contain a load of gibberish you won‚Äôt need to understand, as I‚Äôll continue to break them down for you!</p>

<h5 id="Ô∏è-the-problem">‚ö†Ô∏è The Problem</h5>
<p>After running the below command, we are faced with several strings that are unintelligible to a human glance!</p>

<p><code class="language-plaintext highlighter-rouge">onedump.py -s 4 -d 93fb9f37eb70c095e26cedc594ca55ab27710039d0f4e92878e6539975ae58aa.one</code></p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230211012951.png" alt="" /><figcaption>
      Truncated mess part 1 &amp; 2

    </figcaption></figure>

<p>So, anyways‚Ä¶</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230216190007.png" />
</figure>
<p>watermarks can be deceptive</p>

<h5 id="-the-solution">üí° The Solution</h5>
<p>Seeing as several aliases were made for <code class="language-plaintext highlighter-rouge">set</code>, it was only a matter of refactoring those lines of code and changing them for readability, in addition repurposing any harmful execution functions to a simply output the resulting PowerShell Script!</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230211235339.png" />
</figure>
<p>Removal of cls, aliases for set and exit /b followed by addition of echo at lines with joint variables</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230211233634.png" alt="" /><figcaption>
      Result of replacing execution functions with echo

    </figcaption></figure>

<p>We‚Äôre left with the <a href="https://www.virustotal.com/gui/file/8052f4636fa5898a4c786dd88288c0116e9c2b0b6e85e98847c2d68d0e926d47/">.NET dropper</a> from the initial Batch script, which would need a bit more work.</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230212023922.png" alt="" /><figcaption>
      Dropper opened in dnSpy

    </figcaption></figure>

<figure class="">
  <img src="/assets/images/zero2auto1/20230212024053.png" alt="" /><figcaption>
      Deobfuscation magic

    </figcaption></figure>

<p>A number of the strings were originally base64-encoded and encrypted by AES - using this <a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)AES_Decrypt(%7B'option':'Hex','string':'c4%20f2%20b3%20eb%20c7%2024%2055%20aa%2017%2097%204b%20d7%20ac%2056%2052%2080%2071%20fb%20eb%20e0%2048%20d2%2063%2043%20d8%202d%20df%2074%20c8%203b%20ee%2095'%7D,%7B'option':'Hex','string':'af%20c6%20a7%2006%20d4%2085%200f%201b%204c%2067%20ab%200a%20cf%208c%202f%205e'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)(7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)&amp;input=Slh4dkQxbklvK3NKazE2Z09ERVNXQndSVWZoMkV3QUtKejdMS1BCMzhlYWh2WFRPVnY5ZU1KYkhadm81TWZvRw">Recipe</a>, you would be able to obtain the ones shown below:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">EtwEventWrite</code> - Patch ETW write events- this is used by defence teams to monitor .NET executables loaded into memory, and several other events that are otherwise not picked up well by Sysmon or Windows Event logs. When <code class="language-plaintext highlighter-rouge">EtwEventWrite</code> is patched alongside AMSI, AV tools and log sources would potentially lose some visibility over that process!</li>
  <li><code class="language-plaintext highlighter-rouge">payload.exe</code> - name of a potential resource</li>
  <li><code class="language-plaintext highlighter-rouge">runpe.dll</code> - also the name of a potential resource, although this one suggests process hollowing</li>
  <li><code class="language-plaintext highlighter-rouge">/c choice /c y /n /d y /t 1 &amp; attrib -h -s "</code> - ran along with <code class="language-plaintext highlighter-rouge">cmd.exe</code> and <code class="language-plaintext highlighter-rouge">del.exe</code>, automatic confirmations to prompts as well as hiding attributes and deletion of the payload from the system</li>
</ul>

<p>The aforementioned recipe should be able to help decrypt the <code class="language-plaintext highlighter-rouge">payload.exe</code> binary that was stored within the resources section.</p>

<figure class="align-center" style="width: 333px">
    <img src="/assets/images/zero2auto1/20230212032016.png" />
</figure>
<p>AsyncRAT‚Äôs functions once fully deobfuscated in dnSpy</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230212031619.png" />
</figure>
<p>C2 information</p>

<p>This concludes my analysis of AsyncRAT. If you would like to gain some more understanding about how the framework works, check out this <a href="https://github.com/NYAN-x-CAT/AsyncRAT-C-Sharp">repo</a>!</p>

<h2 id="the-outcome">The Outcome</h2>
<p>One of the main takeaways of the challenge was to understand how to analyse distributed email attachments. Since OneNote files are similar to other files from the Office Suite, they can also store HTML applications, VBScripts, portable executables, PowerShell scripts and even LNK files (which, if you are interested, can be learned more about <a href="https://youtu.be/wu4-nREmzGM">here</a>).</p>

<p>Additionally, knowing when to switch between static and dynamic analysis is key to being a tactful reverse engineer. Unless you‚Äôre doing a full on binary instrumentation for automation, your main objective is to discover and present the IOCs to look out as soon as possible. Creating your own YARA rules (and even an emulation script if you plan to automate your analysis) quickly speeds up your future analysis efforts and enables you to hunt malware in bulk.</p>

<p>It would only be a matter of time before Microsoft addresses the threat actors hype on abusing OneNote files and temporarily put an end to their fun, before they figure out another creative way of breaking in! As much as I hate to say it, these criminals always give us something fun to play with. Now if only they didn‚Äôt get real companies involved and put actual lives and careers in danger!</p>

<p>An immeasurable amount of credit goes to <a href="https://twitter.com/0verfl0w_">0verfl0w_</a> and <a href="https://twitter.com/sysopfb">sysopfb</a>, who patiently answered a lot of my questions regarding automation in the past (which I will be demonstrating in the next section) and encouraged me to set up the challenge!</p>

<h2 id="extras-semi-automation">Extras: (Semi) Automation!</h2>
<p>Seeing as we cooked up a various recipes using CyberChef, I thought it would be a great opportunity to <a href="https://github.com/MalwareGuy/Automation/blob/main/AsyncRAT/extractor.py">automate</a> majority of the workflow.</p>

<figure class="">
  <img src="/assets/images/zero2auto1/20230217231727.png" alt="" /><figcaption>
      Preview of the parser

    </figcaption></figure>

<p>The parser should work on any specimen that is structured similarly to the one within this post. One thing I wished I knew was how many cross references to each user-defined string there were inside the PE file - knowing this would be a lot more helpful when identifying the key and initialisation vector! Since I was unable to identify the opcodes for <code class="language-plaintext highlighter-rouge">ldstr</code> followed by the addresses of the key and IV user strings within the hex dump of the first .NET binary, I had to make do with hardcoded values, which can lead to issues within the <code class="language-plaintext highlighter-rouge">ExtractKeyIVNET</code> function.</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230216013858.png" />
</figure>
<p>AES key within the hex dump of dnspy</p>

<p>However, I‚Äôm sure this could be covered inside a binary instrumentation tool, which I‚Äôll be keen on exploring in the future.</p>

<figure class="align-center" style="width: 666px">
    <img src="/assets/images/zero2auto1/20230216161153.png" />
</figure>

<p>For all my other peers breaking into malware research, I‚Äôd highly encourage learning to automate portions of your analysis. Take my word - it doesn‚Äôt matter how scuffed or impractical your code is, what truly brings value is understanding file/data structures and how much of your tasks you can automate, besides you can improve your code and even end up reusing your refined code in production as you progress! In my case, I was already experienced in Python, but I hadn‚Äôt coded any projects in it majorly for years - I think this was a great exercise to shake off the rust and face the music with the superior programming language! No puns intended.</p>

<h2 id="hunting">Hunting</h2>
<p>Process creation : <code class="language-plaintext highlighter-rouge">onenote.exe</code> as the parent process with either of the following child processes, possibly leading to a network connection:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">mshta.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">powershell.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">cmd.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">wmiprvse.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">wscript.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">copy.exe</code></li>
  <li><code class="language-plaintext highlighter-rouge">del.exe</code></li>
</ul>

<p>File creations &amp; deletions</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#asyncrat" class="page__taxonomy-item p-category" rel="tag">AsyncRAT</a><span class="sep">, </span>
    
      <a href="/tags/#didier-stevens-suite" class="page__taxonomy-item p-category" rel="tag">Didier Stevens Suite</a><span class="sep">, </span>
    
      <a href="/tags/#dnspy" class="page__taxonomy-item p-category" rel="tag">dnSpy</a><span class="sep">, </span>
    
      <a href="/tags/#onedump-py" class="page__taxonomy-item p-category" rel="tag">onedump.py</a><span class="sep">, </span>
    
      <a href="/tags/#onenote-malware" class="page__taxonomy-item p-category" rel="tag">OneNote Malware</a><span class="sep">, </span>
    
      <a href="/tags/#x64dbg" class="page__taxonomy-item p-category" rel="tag">x64dbg</a><span class="sep">, </span>
    
      <a href="/tags/#yara" class="page__taxonomy-item p-category" rel="tag">YARA</a><span class="sep">, </span>
    
      <a href="/tags/#zero2automated-challenges" class="page__taxonomy-item p-category" rel="tag">Zero2Automated Challenges</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#hunts" class="page__taxonomy-item p-category" rel="tag">Hunts</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2023-02-18T00:00:00+00:00">February 18, 2023</time></p>

      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Zero2Automated+-+January+2023+Challenge%20http%3A%2F%2Flocalhost%3A4000%2FHunts%2Fzero2automated-jan-2023-challenge.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FHunts%2Fzero2automated-jan-2023-challenge.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FHunts%2Fzero2automated-jan-2023-challenge.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/RE-Notes/pointers.html" class="pagination--pager" title="Pointers (&amp;memes explained)
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You may also enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/pointers/forgor.jpeg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/RE-Notes/pointers.html" rel="permalink">Pointers (&amp;memes explained)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">This RE shitpost note was not sponsored by the OALabs Patreon, however if you don‚Äôt have it already go and check their awesome content out. I would also like...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/nppspy/shaggy.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Hunts/nppspy.html" rel="permalink">The Curious Case of MPNotify &amp; NPPSPY
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Today‚Äôs hunt was inspired from this awesome blog by Dray Agha! Also a special thanks to Robsware for taking the time out his day to proofread this post! Bug,...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/patching/20221213193543.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/RE-notes/patching.html" rel="permalink">Patching
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          9 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I wrote this post as I thought it would be fun to explore some reverse engineering techniques ‚Äî in (almost) simplified terms! Typically, patching can be used...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/ecthpv2/ecthpv2_logo.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Course-Reviews/eCTHPv2.html" rel="permalink">My eCTHPv2 Experiences
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I taken eCTHPv2 back in April, and eventually decided I wanted to write my personal thoughts and overall experience around the course!

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://www.twitch.tv/malware_guy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitch" aria-hidden="true"></i> Twitch</a></li>
        
      
        
          <li><a href="https://twitter.com/themalwareguy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/MalwareGuy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.youtube.com/channel/UCKLRrI3yzes4p8GpWAdwevg" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube</a></li>
        
      
        
          <li><a href="https://discord.gg/kvU3kvt4Qb" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-discord" aria-hidden="true"></i> Discord</a></li>
        
      
        
          <li><a href="https://www.instagram.com/malware_guy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://infosec.exchange/@malware_guy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i> Mastodon</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Malware Guy. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>. PS: If you knowingly stumble upon any malware from my hunts and end up downloading it and infecting yourself, I will point and laugh at you. I hold no liability over the cat's curiosity if it gets the better of them!</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
